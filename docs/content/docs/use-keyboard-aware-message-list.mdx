---
title: useKeyboardAwareMessageList
description: Smooth keyboard handling for chat message lists
---

`useKeyboardAwareMessageList` handles the complex keyboard interactions in a chat interface. When the keyboard opens or closes, it keeps messages visible and properly positioned.

## Usage

```tsx
import { useKeyboardAwareMessageList } from 'aix'

function MessageList({ messages }) {
  useKeyboardAwareMessageList({
    numMessages: messages.length,
    bottomInset: 34, // Safe area bottom inset
    chatPaddingBottom: 16,
  })

  // ... rest of your list
}
```

## Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `numMessages` | `number` | Required | Current number of messages |
| `bottomInset` | `number` | `0` | Safe area bottom inset |
| `chatPaddingBottom` | `number` | `0` | Extra padding at the bottom of the chat |

## What It Does

### Keyboard Open

When the keyboard opens, the hook:

1. Calculates how much to offset the scroll position
2. Transforms the content up to keep the current view visible
3. Handles the case where you're scrolled to the bottom vs. somewhere in the middle

### Keyboard Close

When the keyboard closes, it:

1. Restores the scroll position smoothly
2. Handles the case where a message was just sent
3. Scrolls to the new message if needed

### Interactive Dismissal

When the user swipes down to dismiss the keyboard, the hook:

1. Tracks the interactive gesture
2. Animates the content in sync with the keyboard
3. Handles the case where the gesture is cancelled

### Message Send Animation

When sending a message with the keyboard closed, the hook:

1. Detects that `isMessageSendAnimating` is true
2. Waits for the new message to appear
3. Scrolls smoothly to show the new message

## How It Works

The hook uses `react-native-keyboard-controller`'s `useKeyboardHandler` to track keyboard events:

```tsx
useKeyboardHandler({
  onStart(e) {
    // Calculate offset values when keyboard animation starts
  },
  onMove(e) {
    // Update scroll offset and transform during animation
  },
  onEnd(e) {
    // Finalize positions when animation ends
  },
  onInteractive(e) {
    // Handle swipe-to-dismiss gesture
  },
})
```

### Scroll Processing

During keyboard animations, the hook temporarily disables LegendList's scroll processing for better performance:

```tsx
listRef.current?.setScrollProcessingEnabled(false)
// ... during animation
listRef.current?.setScrollProcessingEnabled(true)
```

### Blank Size Sync

The hook also reacts to changes in the message list while the keyboard is open. If new messages arrive or the blank space changes, it recalculates positions to keep everything in sync.

## Example

```tsx
import {
  useKeyboardAwareMessageList,
  useMessageListProps,
  useUpdateLastMessageIndex,
} from 'aix'
import { AnimatedLegendList } from '@legendapp/list/reanimated'
import { useSafeAreaInsets } from 'react-native-safe-area-context'

function MessageList({ messages }) {
  const { bottom } = useSafeAreaInsets()
  const numMessages = messages.length

  useKeyboardAwareMessageList({
    numMessages,
    bottomInset: bottom,
    chatPaddingBottom: 16,
  })

  useUpdateLastMessageIndex({ numMessages })

  const props = useMessageListProps()

  return (
    <AnimatedLegendList
      data={messages}
      keyExtractor={(item) => item.id}
      renderItem={({ item, index }) => (
        <MessageItem message={item} index={index} />
      )}
      keyboardDismissMode="interactive"
      {...props}
    />
  )
}
```

## Requirements

This hook requires:

- `MessageListContextProvider` – For scroll state
- `ComposerHeightContextProvider` – For composer height
- `KeyboardStateProvider` – For keyboard state
- `ChatAnimationProvider` – For send animation state
- `KeyboardProvider` from `react-native-keyboard-controller`

## Related Hooks

- [useMessageListProps](/docs/use-message-list-props) – Get list props
- [useScrollMessageListFromComposerSizeUpdates](/docs/use-scroll-from-composer) – Auto-scroll on composer resize
- [useChatAnimation](/docs/providers#chatanimationprovider) – Trigger send animations

