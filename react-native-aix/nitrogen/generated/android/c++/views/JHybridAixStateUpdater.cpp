///
/// JHybridAixStateUpdater.cpp
/// This file was generated by nitrogen. DO NOT MODIFY THIS FILE.
/// https://github.com/mrousavy/nitro
/// Copyright Â© 2026 Marc Rousavy @ Margelo
///

#include "JHybridAixStateUpdater.hpp"
#include "views/HybridAixComponent.hpp"
#include <NitroModules/NitroDefines.hpp>

namespace margelo::nitro::aix::views {

using namespace facebook;
using ConcreteStateData = react::ConcreteState<HybridAixState>;

void JHybridAixStateUpdater::updateViewProps(jni::alias_ref<jni::JClass> /* class */,
                                           jni::alias_ref<JHybridAixSpec::javaobject> javaView,
                                           jni::alias_ref<JStateWrapper::javaobject> stateWrapperInterface) {
  JHybridAixSpec* view = javaView->cthis();

  // Get concrete StateWrapperImpl from passed StateWrapper interface object
  jobject rawStateWrapper = stateWrapperInterface.get();
  if (!stateWrapperInterface->isInstanceOf(react::StateWrapperImpl::javaClassStatic())) {
      throw std::runtime_error("StateWrapper is not a StateWrapperImpl");
  }
  auto stateWrapper = jni::alias_ref<react::StateWrapperImpl::javaobject>{
            static_cast<react::StateWrapperImpl::javaobject>(rawStateWrapper)};

  std::shared_ptr<const react::State> state = stateWrapper->cthis()->getState();
  auto concreteState = std::dynamic_pointer_cast<const ConcreteStateData>(state);
  const HybridAixState& data = concreteState->getData();
  const std::optional<HybridAixProps>& maybeProps = data.getProps();
  if (!maybeProps.has_value()) {
    // Props aren't set yet!
    throw std::runtime_error("HybridAixState's data doesn't contain any props!");
  }
  const HybridAixProps& props = maybeProps.value();
  if (props.shouldStartAtEnd.isDirty) {
    view->setShouldStartAtEnd(props.shouldStartAtEnd.value);
    // TODO: Set isDirty = false
  }
  if (props.scrollOnFooterSizeUpdate.isDirty) {
    view->setScrollOnFooterSizeUpdate(props.scrollOnFooterSizeUpdate.value);
    // TODO: Set isDirty = false
  }
  if (props.scrollEndReachedThreshold.isDirty) {
    view->setScrollEndReachedThreshold(props.scrollEndReachedThreshold.value);
    // TODO: Set isDirty = false
  }
  if (props.additionalContentInsets.isDirty) {
    view->setAdditionalContentInsets(props.additionalContentInsets.value);
    // TODO: Set isDirty = false
  }
  if (props.additionalScrollIndicatorInsets.isDirty) {
    view->setAdditionalScrollIndicatorInsets(props.additionalScrollIndicatorInsets.value);
    // TODO: Set isDirty = false
  }
  if (props.mainScrollViewID.isDirty) {
    view->setMainScrollViewID(props.mainScrollViewID.value);
    // TODO: Set isDirty = false
  }
  if (props.penultimateCellIndex.isDirty) {
    view->setPenultimateCellIndex(props.penultimateCellIndex.value);
    // TODO: Set isDirty = false
  }
  if (props.shouldApplyContentInsets.isDirty) {
    view->setShouldApplyContentInsets(props.shouldApplyContentInsets.value);
    // TODO: Set isDirty = false
  }
  if (props.onWillApplyContentInsets.isDirty) {
    view->setOnWillApplyContentInsets(props.onWillApplyContentInsets.value);
    // TODO: Set isDirty = false
  }
  if (props.onScrolledNearEndChange.isDirty) {
    view->setOnScrolledNearEndChange(props.onScrolledNearEndChange.value);
    // TODO: Set isDirty = false
  }

  // Update hybridRef if it changed
  if (props.hybridRef.isDirty) {
    // hybridRef changed - call it with new this
    const auto& maybeFunc = props.hybridRef.value;
    if (maybeFunc.has_value()) {
      std::shared_ptr<JHybridAixSpec> shared = javaView->cthis()->shared_cast<JHybridAixSpec>();
      maybeFunc.value()(shared);
    }
    // TODO: Set isDirty = false
  }
}

} // namespace margelo::nitro::aix::views
